<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enjoyTrip.OdysseyFrontiers.member.model.mapper.MemberMapper">

    <resultMap type="com.enjoyTrip.OdysseyFrontiers.member.model.dto.MemberDto" id="member">
        <result column="member_id" property="memberId"/>
<!--         <result column="name" property="name"/> -->
        <result column="email_id" property="emailId"/>
        <result column="email_domain" property="emailDomain"/>
<!--         <result column="password" property="password"/>
        <result column="phone" property="phone"/>
        <result column="address" property="address"/> -->
        <result column="birthday" property="birthday"/>
        <result column="join_date" property="joinDate"/>
    </resultMap>

    <!-- ADMIN -->
    <!-- 	<resultMap type="memberDto" id="memberAll" extends="member">
            <result column="user_password" property="userPwd"/>
            <result column="email_id" property="emailId"/>
            <result column="email_domain" property="emailDomain"/>
            <result column="join_date" property="joinDate"/>
        </resultMap> -->

    <select id="idCheck" parameterType="map" resultType="int">
        select count(member_id)
        from members
        where email_id = #{emailId} and email_domain = #{emailDomain}
    </select>

    <insert id="joinMember" parameterType="memberDto">
        insert into members (name, email_id, email_domain, password, phone,
                             address, birthday, join_date)
        values (#{name}, #{emailId}, #{emailDomain}, #{password}, #{phone},
                #{address},#{birthday}, now())
    </insert>

    <select id="loginMember" parameterType="map" resultMap="member">
        select *
        from members
        where email_id = #{emailId} and email_domain = #{emailDomain} and password = #{password}
    </select>

    <!-- ADMIN -->
    <!-- 	<select id="listMember" resultMap="memberAll">
            select user_name, user_id, user_password, email_id, email_domain, join_date
            from members
            order by join_date
        </select> -->

    <!-- 	<select id="getMember" parameterType="string" resultMap="memberAll">
            select user_id, user_name, user_password, email_id, email_domain, join_date
            from members
            where user_id = #{userId}
        </select> -->

    <update id="updateMember" parameterType="memberDto">
        update members
        <trim prefix="set" suffixOverrides=",">
            <if test="name != null">name = #{name},</if>
            <if test="emailId != null">email_id = #{emailId},</if>
            <if test="emailDomain != null">email_domain = #{emailDomain},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="address != null">address = #{address},</if>
            <if test="status != null">status = #{status},</if>
        </trim>
        where member_id = #{memberId}
    </update>

    <update id="updatePassword" parameterType="memberDto">
        update members
        <trim prefix="set" suffixOverrides=",">
            <if test="password != null">password = #{password}</if>
        </trim>
        where member_id = #{memberId}
    </update>

    <select id="findPassword" parameterType="String">
        select password
        from members
        where member_id = #{memberId}
    </select>

    <delete id="deleteMember" parameterType="String">
        delete from members
        where member_id = #{memberId}
    </delete>


    <select id="findByName" parameterType="String" resultMap="member">
        select *
        from members
        where name = #{name}
    </select>

    <select id="findByMemberId" parameterType="Long" resultMap="member">
        select *
        from members
        where member_id = #{memberId}
    </select>

    <select id="findAllMembers" resultMap="member">
        select *
        from members
    </select>


<select id="memberInfo" parameterType="long" resultMap="member">
		select *
		from members
		where member_id = #{memberId}
	</select>

<update id="saveRefreshToken" parameterType="map">
		update members
		set refresh_token = #{token}
		where member_id = #{memberId}
	</update>
	
	<select id="getRefreshToken" parameterType="long" resultType="string">
		select refresh_token
		from members
		where member_id = #{memberId}
	</select>
	
	<update id="deleteRefreshToken" parameterType="map">
		update members
		set refresh_token = #{token, jdbcType=VARCHAR}
		where member_id = #{memberId}
	</update>

</mapper>